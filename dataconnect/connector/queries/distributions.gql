# ============================
# DISTRIBUTION QUERIES
# ============================

# List all distributions with pagination
query ListDistributions($limit: Int = 8, $offset: Int = 0) @auth(level: USER) {
  distributions(limit: $limit, offset: $offset, orderBy: [{ distributionDate: ASC }]) {
    id
    distributionDate
    observations
    responsibleStaff {
      id
      name
    }
    beneficiary {
      id
      fullName
      studentNumer
    }
    status {
      id
      code
      description
    }
    createdAt
  }
}

# Get distribution by id
query GetDistributionById($id: UUID!) @auth(level: USER) {
  distribution(id: $id) {
    id
    distributionDate
    observations
    responsibleStaff {
      id
      name
      email
    }
    beneficiary {
      id
      fullName
      studentNumer
      contactNumber
    }
    status {
      id
      code
      description
      color
    }
    createdAt
  }
}



# List distributions by beneficiary
query ListDistributionsByBeneficiary($beneficiaryId: UUID!, $limit: Int = 8, $offset: Int = 0) @auth(level: USER) {
  distributions(
    where: { beneficiary: { id: { eq: $beneficiaryId } } }
    limit: $limit
    offset: $offset
    orderBy: [{ distributionDate: ASC }]
  ) {
    id
    distributionDate
    observations
    responsibleStaff {
      id
      name
    }
    status {
      id
      code
      description
    }
    createdAt
  }
}

# List distributions by beneficiary and status
query ListDistributionsByBeneficiaryAndStatus($beneficiaryId: UUID!, $statusCode: String!, $limit: Int = 8, $offset: Int = 0) @auth(level: USER) {
  distributions(
    where: {
      _and: [
        { beneficiary: { id: { eq: $beneficiaryId } } }
        { status: { code: { eq: $statusCode } } }
      ]
    }
    limit: $limit
    offset: $offset
    orderBy: [{ distributionDate: ASC }]
  ) {
    id
    distributionDate
    observations
    responsibleStaff {
      id
      name
    }
    status {
      id
      code
      description
    }
    createdAt
  }
}

# Note: Search by partial UUID is not supported by Firebase Data Connect
# UUIDs only support exact match with 'eq', not 'contains'

# List distributions by status
query ListDistributionsByStatus($statusCode: String!, $limit: Int = 8, $offset: Int = 0) @auth(level: USER) {
  distributions(
    where: { status: { code: { eq: $statusCode } } }
    limit: $limit
    offset: $offset
    orderBy: [{ distributionDate: ASC }]
  ) {
    id
    distributionDate
    observations
    responsibleStaff {
      id
      name
    }
    beneficiary {
      id
      fullName
      studentNumer
    }
    status {
      id
      code
      description
    }
    createdAt
  }
}

